const defaults={targetElementClass:"autosizes",processedElementClass:"autosized",sizesAttr:"sizes",minSize:40,init:!0,resizeDebounce:99};let config={...defaults};function initConfig(){const t=window.autoSizesConfig||{};config={...defaults,...t}}function getWidth(t,e,i){for(i=i||t.offsetWidth;i<config.minSize&&e&&!t._autosizesWidth;)i=e.offsetWidth,e=e.parentNode;return i}function debounce(t){let e,i;const n=config.resizeDebounce,s=()=>{e=null,t()},o=()=>{const t=Date.now()-i;t<n?e=setTimeout(o,n-t):window.requestIdleCallback?requestIdleCallback(s):s()};return()=>{i=Date.now(),e||(e=setTimeout(o,n))}}const rAF=(()=>{let t=!1,e=!1;const i=[],n=()=>{for(t=!0,e=!1;i.length;){i.shift()()}t=!1};return s=>{t?s():(i.push(s),e||(e=!0,requestAnimationFrame(n)))}})();function rAFIt(t){return function(...e){rAF(()=>{t.apply(this,e)})}}function triggerEvent(t,e,i={}){const n=new CustomEvent(e,{detail:i,bubbles:!0,cancelable:!0});return t.dispatchEvent(n),n}const regPicture=/^picture$/i;function hasPrefix(t){return t.includes("-")&&"sizes"!==t}function getBaseAttr(t){if(hasPrefix(t)){const e=t.split("-");return e[e.length-1]}return t}const autoSizer=(()=>{let t;const e=t=>"auto"===t.getAttribute(config.sizesAttr),i=(t,e)=>{if(t.setAttribute(config.sizesAttr,e),hasPrefix(config.sizesAttr)){const i=getBaseAttr(config.sizesAttr);t.setAttribute(i,e)}},n=rAFIt((t,n,s,o)=>{t._autosizesWidth=o;const r=`${o}px`;if(e(t)&&i(t,r),regPicture.test(n.nodeName||"")){const t=n.getElementsByTagName("source");for(let n=0;n<t.length;n++)e(t[n])&&i(t[n],r)}config.processedElementClass&&t.classList.add(config.processedElementClass),triggerEvent(t,"afterSizesUpdate",{width:o,sizes:r})}),s=(t,e,i)=>{const s=t.parentNode;if(!s)return;const o=triggerEvent(t,"beforeSizesUpdate",{width:i=getWidth(t,s,i),dataAttr:!!e});o.defaultPrevented||(i=o.detail.width)&&i!==t._autosizesWidth&&n(t,s,o,i)},o=()=>{if(t&&t.length)for(let e=0;e<t.length;e++)s(t[e])},r=debounce(o);return{init:()=>{t=document.getElementsByClassName(config.targetElementClass),window.addEventListener("resize",r),o()},updateAll:r,updateElem:s}})();function init(){init.initialized||(init.initialized=!0,initConfig(),autoSizer.init())}const autoSizes={cfg:config,autoSizer:autoSizer,init:init,updateAll:()=>autoSizer.updateAll(),updateElem:t=>autoSizer.updateElem(t)};export default autoSizes;